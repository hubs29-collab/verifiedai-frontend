<!DOCTYPE html>
<html>
<head>
  <title>VerifiedAI</title>
  <style>
    body { font-family: Arial; background:#f4f6f8; }
    .card { background:white; padding:15px; margin:15px auto; max-width:700px; }
    button { background:#2563eb; color:white; padding:6px 10px; border:none; }
    select { width:100%; margin-top:5px; }
  </style>
</head>

<body>

<div class="card">
  <button onclick="startJob()">Start Verification</button>
</div>

<div class="card">
  <input id="desc" placeholder="Paint living room wall">
  <input id="cost" placeholder="2800">
  <button onclick="addItem()">Add Item</button>
</div>

<div class="card">
  <input type="file" id="fileInput" multiple>
  <button onclick="uploadEvidence()">Upload Evidence</button>
</div>

<div class="card">
  <h4>Map Evidence to Item</h4>
  <select id="itemSelect"></select>
  <select id="evidenceSelect" multiple></select>
  <button onclick="mapEvidence()">Map</button>
</div>

<div class="card">
  <button onclick="analyze()">Analyze</button>
  <pre id="out"></pre>
</div>

<script>
const API = "https://ebb700d3-0624-496c-8a99-8d7888669f68-00-2wqp9jjowl32z.picard.replit.dev";
let jobId, items=[], evidence=[];

async function startJob(){
  const r=await fetch(API+"/jobs",{method:"POST"});
  jobId=(await r.json()).id;
}

async function addItem(){
  const r=await fetch(`${API}/items/${jobId}`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({description:desc.value,cost:cost.value})
  });
  const i=await r.json(); items.push(i);
  itemSelect.innerHTML+=`<option value="${i.id}">${i.description}</option>`;
}

async function uploadEvidence(){
  const fd=new FormData();
  for(const f of fileInput.files) fd.append("files",f);
  const r=await fetch(`${API}/evidence/${jobId}`,{method:"POST",body:fd});
  evidence=await r.json();
  evidenceSelect.innerHTML=evidence.map(e=>`<option value="${e.id}">${e.name}</option>`).join("");
}

async function mapEvidence(){
  const itemId=itemSelect.value;
  const evidenceIds=[...evidenceSelect.selectedOptions].map(o=>o.value);
  await fetch(`${API}/map/${jobId}/${itemId}`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({evidenceIds})
  });
}

async function analyze(){
  await fetch(`${API}/analyze/${jobId}`,{method:"POST"});
  const r=await fetch(`${API}/results/${jobId}`);
  out.textContent=JSON.stringify(await r.json(),null,2);
}
</script>

</body>
</html>
